"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _errors = require("../../../errors");
const _setRequestContext = require("../../../express/setRequestContext");
const _init = require("../../../translations/init");
const _getFileByPath = /*#__PURE__*/ _interop_require_default(require("../../../uploads/getFileByPath"));
const _dataloader = require("../../dataloader");
const _update = /*#__PURE__*/ _interop_require_default(require("../update"));
const _updateByID = /*#__PURE__*/ _interop_require_default(require("../updateByID"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
async function updateLocal(payload, options) {
    const { id, autosave, collection: collectionSlug, context, data, depth, draft, fallbackLocale: fallbackLocaleArg = options?.req?.fallbackLocale, file, filePath, locale: localeArg = null, overrideAccess = true, overwriteExistingFiles = false, req: incomingReq, showHiddenFields, user, where } = options;
    const collection = payload.collections[collectionSlug];
    const i18n = (0, _init.i18nInit)(payload.config.i18n);
    const localizationConfig = payload?.config?.localization;
    const defaultLocale = localizationConfig ? localizationConfig.defaultLocale : null;
    const locale = localeArg || incomingReq?.locale || defaultLocale;
    const fallbackLocale = localizationConfig ? localizationConfig.locales.find(({ code })=>locale === code)?.fallbackLocale : null;
    if (!collection) {
        throw new _errors.APIError(`The collection with slug ${String(collectionSlug)} can't be found. Update Operation.`);
    }
    const req = {
        fallbackLocale: typeof fallbackLocaleArg !== 'undefined' ? fallbackLocaleArg : fallbackLocale || defaultLocale,
        files: {
            file: file ?? await (0, _getFileByPath.default)(filePath)
        },
        i18n,
        locale: locale ?? defaultLocale,
        payload,
        payloadAPI: 'local',
        transactionID: incomingReq?.transactionID,
        user
    };
    (0, _setRequestContext.setRequestContext)(req, context);
    if (!req.t) req.t = req.i18n.t;
    if (!req.payloadDataLoader) req.payloadDataLoader = (0, _dataloader.getDataLoader)(req);
    const args = {
        id,
        autosave,
        collection,
        data,
        depth,
        draft,
        overrideAccess,
        overwriteExistingFiles,
        payload,
        req,
        showHiddenFields,
        where
    };
    if (options.id) {
        return (0, _updateByID.default)(args);
    }
    return (0, _update.default)(args);
}
const _default = updateLocal;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb2xsZWN0aW9ucy9vcGVyYXRpb25zL2xvY2FsL3VwZGF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IERlZXBQYXJ0aWFsIH0gZnJvbSAndHMtZXNzZW50aWFscydcblxuaW1wb3J0IHR5cGUgeyBHZW5lcmF0ZWRUeXBlcyB9IGZyb20gJy4uLy4uLy4uLydcbmltcG9ydCB0eXBlIHsgUGF5bG9hZFJlcXVlc3QsIFJlcXVlc3RDb250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vZXhwcmVzcy90eXBlcydcbmltcG9ydCB0eXBlIHsgUGF5bG9hZCB9IGZyb20gJy4uLy4uLy4uL3BheWxvYWQnXG5pbXBvcnQgdHlwZSB7IERvY3VtZW50LCBXaGVyZSB9IGZyb20gJy4uLy4uLy4uL3R5cGVzJ1xuaW1wb3J0IHR5cGUgeyBGaWxlIH0gZnJvbSAnLi4vLi4vLi4vdXBsb2Fkcy90eXBlcydcbmltcG9ydCB0eXBlIHsgQnVsa09wZXJhdGlvblJlc3VsdCB9IGZyb20gJy4uLy4uL2NvbmZpZy90eXBlcydcblxuaW1wb3J0IHsgQVBJRXJyb3IgfSBmcm9tICcuLi8uLi8uLi9lcnJvcnMnXG5pbXBvcnQgeyBzZXRSZXF1ZXN0Q29udGV4dCB9IGZyb20gJy4uLy4uLy4uL2V4cHJlc3Mvc2V0UmVxdWVzdENvbnRleHQnXG5pbXBvcnQgeyBpMThuSW5pdCB9IGZyb20gJy4uLy4uLy4uL3RyYW5zbGF0aW9ucy9pbml0J1xuaW1wb3J0IGdldEZpbGVCeVBhdGggZnJvbSAnLi4vLi4vLi4vdXBsb2Fkcy9nZXRGaWxlQnlQYXRoJ1xuaW1wb3J0IHsgZ2V0RGF0YUxvYWRlciB9IGZyb20gJy4uLy4uL2RhdGFsb2FkZXInXG5pbXBvcnQgdXBkYXRlIGZyb20gJy4uL3VwZGF0ZSdcbmltcG9ydCB1cGRhdGVCeUlEIGZyb20gJy4uL3VwZGF0ZUJ5SUQnXG5cbmV4cG9ydCB0eXBlIEJhc2VPcHRpb25zPFRTbHVnIGV4dGVuZHMga2V5b2YgR2VuZXJhdGVkVHlwZXNbJ2NvbGxlY3Rpb25zJ10+ID0ge1xuICBhdXRvc2F2ZT86IGJvb2xlYW5cbiAgY29sbGVjdGlvbjogVFNsdWdcbiAgLyoqXG4gICAqIGNvbnRleHQsIHdoaWNoIHdpbGwgdGhlbiBiZSBwYXNzZWQgdG8gcmVxLmNvbnRleHQsIHdoaWNoIGNhbiBiZSByZWFkIGJ5IGhvb2tzXG4gICAqL1xuICBjb250ZXh0PzogUmVxdWVzdENvbnRleHRcbiAgZGF0YTogRGVlcFBhcnRpYWw8R2VuZXJhdGVkVHlwZXNbJ2NvbGxlY3Rpb25zJ11bVFNsdWddPlxuICBkZXB0aD86IG51bWJlclxuICBkcmFmdD86IGJvb2xlYW5cbiAgZmFsbGJhY2tMb2NhbGU/OiBzdHJpbmdcbiAgZmlsZT86IEZpbGVcbiAgZmlsZVBhdGg/OiBzdHJpbmdcbiAgbG9jYWxlPzogc3RyaW5nXG4gIG92ZXJyaWRlQWNjZXNzPzogYm9vbGVhblxuICBvdmVyd3JpdGVFeGlzdGluZ0ZpbGVzPzogYm9vbGVhblxuICByZXE/OiBQYXlsb2FkUmVxdWVzdFxuICBzaG93SGlkZGVuRmllbGRzPzogYm9vbGVhblxuICB1c2VyPzogRG9jdW1lbnRcbn1cblxuZXhwb3J0IHR5cGUgQnlJRE9wdGlvbnM8VFNsdWcgZXh0ZW5kcyBrZXlvZiBHZW5lcmF0ZWRUeXBlc1snY29sbGVjdGlvbnMnXT4gPSBCYXNlT3B0aW9uczxUU2x1Zz4gJiB7XG4gIGlkOiBudW1iZXIgfCBzdHJpbmdcbiAgd2hlcmU/OiBuZXZlclxufVxuXG5leHBvcnQgdHlwZSBNYW55T3B0aW9uczxUU2x1ZyBleHRlbmRzIGtleW9mIEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddPiA9IEJhc2VPcHRpb25zPFRTbHVnPiAmIHtcbiAgaWQ/OiBuZXZlclxuICB3aGVyZTogV2hlcmVcbn1cblxuZXhwb3J0IHR5cGUgT3B0aW9uczxUU2x1ZyBleHRlbmRzIGtleW9mIEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddPiA9XG4gIHwgQnlJRE9wdGlvbnM8VFNsdWc+XG4gIHwgTWFueU9wdGlvbnM8VFNsdWc+XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsPFRTbHVnIGV4dGVuZHMga2V5b2YgR2VuZXJhdGVkVHlwZXNbJ2NvbGxlY3Rpb25zJ10+KFxuICBwYXlsb2FkOiBQYXlsb2FkLFxuICBvcHRpb25zOiBCeUlET3B0aW9uczxUU2x1Zz4sXG4pOiBQcm9taXNlPEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddW1RTbHVnXT5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsPFRTbHVnIGV4dGVuZHMga2V5b2YgR2VuZXJhdGVkVHlwZXNbJ2NvbGxlY3Rpb25zJ10+KFxuICBwYXlsb2FkOiBQYXlsb2FkLFxuICBvcHRpb25zOiBNYW55T3B0aW9uczxUU2x1Zz4sXG4pOiBQcm9taXNlPEJ1bGtPcGVyYXRpb25SZXN1bHQ8VFNsdWc+PlxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYWw8VFNsdWcgZXh0ZW5kcyBrZXlvZiBHZW5lcmF0ZWRUeXBlc1snY29sbGVjdGlvbnMnXT4oXG4gIHBheWxvYWQ6IFBheWxvYWQsXG4gIG9wdGlvbnM6IE9wdGlvbnM8VFNsdWc+LFxuKTogUHJvbWlzZTxCdWxrT3BlcmF0aW9uUmVzdWx0PFRTbHVnPiB8IEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddW1RTbHVnXT5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsPFRTbHVnIGV4dGVuZHMga2V5b2YgR2VuZXJhdGVkVHlwZXNbJ2NvbGxlY3Rpb25zJ10+KFxuICBwYXlsb2FkOiBQYXlsb2FkLFxuICBvcHRpb25zOiBPcHRpb25zPFRTbHVnPixcbik6IFByb21pc2U8QnVsa09wZXJhdGlvblJlc3VsdDxUU2x1Zz4gfCBHZW5lcmF0ZWRUeXBlc1snY29sbGVjdGlvbnMnXVtUU2x1Z10+IHtcbiAgY29uc3Qge1xuICAgIGlkLFxuICAgIGF1dG9zYXZlLFxuICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25TbHVnLFxuICAgIGNvbnRleHQsXG4gICAgZGF0YSxcbiAgICBkZXB0aCxcbiAgICBkcmFmdCxcbiAgICBmYWxsYmFja0xvY2FsZTogZmFsbGJhY2tMb2NhbGVBcmcgPSBvcHRpb25zPy5yZXE/LmZhbGxiYWNrTG9jYWxlLFxuICAgIGZpbGUsXG4gICAgZmlsZVBhdGgsXG4gICAgbG9jYWxlOiBsb2NhbGVBcmcgPSBudWxsLFxuICAgIG92ZXJyaWRlQWNjZXNzID0gdHJ1ZSxcbiAgICBvdmVyd3JpdGVFeGlzdGluZ0ZpbGVzID0gZmFsc2UsXG4gICAgcmVxOiBpbmNvbWluZ1JlcSxcbiAgICBzaG93SGlkZGVuRmllbGRzLFxuICAgIHVzZXIsXG4gICAgd2hlcmUsXG4gIH0gPSBvcHRpb25zXG5cbiAgY29uc3QgY29sbGVjdGlvbiA9IHBheWxvYWQuY29sbGVjdGlvbnNbY29sbGVjdGlvblNsdWddXG4gIGNvbnN0IGkxOG4gPSBpMThuSW5pdChwYXlsb2FkLmNvbmZpZy5pMThuKVxuICBjb25zdCBsb2NhbGl6YXRpb25Db25maWcgPSBwYXlsb2FkPy5jb25maWc/LmxvY2FsaXphdGlvblxuICBjb25zdCBkZWZhdWx0TG9jYWxlID0gbG9jYWxpemF0aW9uQ29uZmlnID8gbG9jYWxpemF0aW9uQ29uZmlnLmRlZmF1bHRMb2NhbGUgOiBudWxsXG4gIGNvbnN0IGxvY2FsZSA9IGxvY2FsZUFyZyB8fCBpbmNvbWluZ1JlcT8ubG9jYWxlIHx8IGRlZmF1bHRMb2NhbGVcbiAgY29uc3QgZmFsbGJhY2tMb2NhbGUgPSBsb2NhbGl6YXRpb25Db25maWdcbiAgICA/IGxvY2FsaXphdGlvbkNvbmZpZy5sb2NhbGVzLmZpbmQoKHsgY29kZSB9KSA9PiBsb2NhbGUgPT09IGNvZGUpPy5mYWxsYmFja0xvY2FsZVxuICAgIDogbnVsbFxuXG4gIGlmICghY29sbGVjdGlvbikge1xuICAgIHRocm93IG5ldyBBUElFcnJvcihcbiAgICAgIGBUaGUgY29sbGVjdGlvbiB3aXRoIHNsdWcgJHtTdHJpbmcoY29sbGVjdGlvblNsdWcpfSBjYW4ndCBiZSBmb3VuZC4gVXBkYXRlIE9wZXJhdGlvbi5gLFxuICAgIClcbiAgfVxuXG4gIGNvbnN0IHJlcSA9IHtcbiAgICBmYWxsYmFja0xvY2FsZTpcbiAgICAgIHR5cGVvZiBmYWxsYmFja0xvY2FsZUFyZyAhPT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgPyBmYWxsYmFja0xvY2FsZUFyZ1xuICAgICAgICA6IGZhbGxiYWNrTG9jYWxlIHx8IGRlZmF1bHRMb2NhbGUsXG4gICAgZmlsZXM6IHtcbiAgICAgIGZpbGU6IGZpbGUgPz8gKGF3YWl0IGdldEZpbGVCeVBhdGgoZmlsZVBhdGgpKSxcbiAgICB9LFxuICAgIGkxOG4sXG4gICAgbG9jYWxlOiBsb2NhbGUgPz8gZGVmYXVsdExvY2FsZSxcbiAgICBwYXlsb2FkLFxuICAgIHBheWxvYWRBUEk6ICdsb2NhbCcsXG4gICAgdHJhbnNhY3Rpb25JRDogaW5jb21pbmdSZXE/LnRyYW5zYWN0aW9uSUQsXG4gICAgdXNlcixcbiAgfSBhcyBQYXlsb2FkUmVxdWVzdFxuICBzZXRSZXF1ZXN0Q29udGV4dChyZXEsIGNvbnRleHQpXG5cbiAgaWYgKCFyZXEudCkgcmVxLnQgPSByZXEuaTE4bi50XG4gIGlmICghcmVxLnBheWxvYWREYXRhTG9hZGVyKSByZXEucGF5bG9hZERhdGFMb2FkZXIgPSBnZXREYXRhTG9hZGVyKHJlcSlcblxuICBjb25zdCBhcmdzID0ge1xuICAgIGlkLFxuICAgIGF1dG9zYXZlLFxuICAgIGNvbGxlY3Rpb24sXG4gICAgZGF0YSxcbiAgICBkZXB0aCxcbiAgICBkcmFmdCxcbiAgICBvdmVycmlkZUFjY2VzcyxcbiAgICBvdmVyd3JpdGVFeGlzdGluZ0ZpbGVzLFxuICAgIHBheWxvYWQsXG4gICAgcmVxLFxuICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gICAgd2hlcmUsXG4gIH1cblxuICBpZiAob3B0aW9ucy5pZCkge1xuICAgIHJldHVybiB1cGRhdGVCeUlEPFRTbHVnPihhcmdzKVxuICB9XG4gIHJldHVybiB1cGRhdGU8VFNsdWc+KGFyZ3MpXG59XG5cbmV4cG9ydCBkZWZhdWx0IHVwZGF0ZUxvY2FsXG4iXSwibmFtZXMiOlsidXBkYXRlTG9jYWwiLCJwYXlsb2FkIiwib3B0aW9ucyIsImlkIiwiYXV0b3NhdmUiLCJjb2xsZWN0aW9uIiwiY29sbGVjdGlvblNsdWciLCJjb250ZXh0IiwiZGF0YSIsImRlcHRoIiwiZHJhZnQiLCJmYWxsYmFja0xvY2FsZSIsImZhbGxiYWNrTG9jYWxlQXJnIiwicmVxIiwiZmlsZSIsImZpbGVQYXRoIiwibG9jYWxlIiwibG9jYWxlQXJnIiwib3ZlcnJpZGVBY2Nlc3MiLCJvdmVyd3JpdGVFeGlzdGluZ0ZpbGVzIiwiaW5jb21pbmdSZXEiLCJzaG93SGlkZGVuRmllbGRzIiwidXNlciIsIndoZXJlIiwiY29sbGVjdGlvbnMiLCJpMThuIiwiaTE4bkluaXQiLCJjb25maWciLCJsb2NhbGl6YXRpb25Db25maWciLCJsb2NhbGl6YXRpb24iLCJkZWZhdWx0TG9jYWxlIiwibG9jYWxlcyIsImZpbmQiLCJjb2RlIiwiQVBJRXJyb3IiLCJTdHJpbmciLCJmaWxlcyIsImdldEZpbGVCeVBhdGgiLCJwYXlsb2FkQVBJIiwidHJhbnNhY3Rpb25JRCIsInNldFJlcXVlc3RDb250ZXh0IiwidCIsInBheWxvYWREYXRhTG9hZGVyIiwiZ2V0RGF0YUxvYWRlciIsImFyZ3MiLCJ1cGRhdGVCeUlEIiwidXBkYXRlIl0sIm1hcHBpbmdzIjoiOzs7OytCQWdKQTs7O2VBQUE7Ozt3QkF2SXlCO21DQUNTO3NCQUNUO3NFQUNDOzRCQUNJOytEQUNYO21FQUNJOzs7Ozs7QUFpRHZCLGVBQWVBLFlBQ2JDLE9BQWdCLEVBQ2hCQyxPQUF1QjtJQUV2QixNQUFNLEVBQ0pDLEVBQUUsRUFDRkMsUUFBUSxFQUNSQyxZQUFZQyxjQUFjLEVBQzFCQyxPQUFPLEVBQ1BDLElBQUksRUFDSkMsS0FBSyxFQUNMQyxLQUFLLEVBQ0xDLGdCQUFnQkMsb0JBQW9CVixTQUFTVyxLQUFLRixjQUFjLEVBQ2hFRyxJQUFJLEVBQ0pDLFFBQVEsRUFDUkMsUUFBUUMsWUFBWSxJQUFJLEVBQ3hCQyxpQkFBaUIsSUFBSSxFQUNyQkMseUJBQXlCLEtBQUssRUFDOUJOLEtBQUtPLFdBQVcsRUFDaEJDLGdCQUFnQixFQUNoQkMsSUFBSSxFQUNKQyxLQUFLLEVBQ04sR0FBR3JCO0lBRUosTUFBTUcsYUFBYUosUUFBUXVCLFdBQVcsQ0FBQ2xCLGVBQWU7SUFDdEQsTUFBTW1CLE9BQU9DLElBQUFBLGNBQVEsRUFBQ3pCLFFBQVEwQixNQUFNLENBQUNGLElBQUk7SUFDekMsTUFBTUcscUJBQXFCM0IsU0FBUzBCLFFBQVFFO0lBQzVDLE1BQU1DLGdCQUFnQkYscUJBQXFCQSxtQkFBbUJFLGFBQWEsR0FBRztJQUM5RSxNQUFNZCxTQUFTQyxhQUFhRyxhQUFhSixVQUFVYztJQUNuRCxNQUFNbkIsaUJBQWlCaUIscUJBQ25CQSxtQkFBbUJHLE9BQU8sQ0FBQ0MsSUFBSSxDQUFDLENBQUMsRUFBRUMsSUFBSSxFQUFFLEdBQUtqQixXQUFXaUIsT0FBT3RCLGlCQUNoRTtJQUVKLElBQUksQ0FBQ04sWUFBWTtRQUNmLE1BQU0sSUFBSTZCLGdCQUFRLENBQ2hCLENBQUMseUJBQXlCLEVBQUVDLE9BQU83QixnQkFBZ0Isa0NBQWtDLENBQUM7SUFFMUY7SUFFQSxNQUFNTyxNQUFNO1FBQ1ZGLGdCQUNFLE9BQU9DLHNCQUFzQixjQUN6QkEsb0JBQ0FELGtCQUFrQm1CO1FBQ3hCTSxPQUFPO1lBQ0x0QixNQUFNQSxRQUFTLE1BQU11QixJQUFBQSxzQkFBYSxFQUFDdEI7UUFDckM7UUFDQVU7UUFDQVQsUUFBUUEsVUFBVWM7UUFDbEI3QjtRQUNBcUMsWUFBWTtRQUNaQyxlQUFlbkIsYUFBYW1CO1FBQzVCakI7SUFDRjtJQUNBa0IsSUFBQUEsb0NBQWlCLEVBQUMzQixLQUFLTjtJQUV2QixJQUFJLENBQUNNLElBQUk0QixDQUFDLEVBQUU1QixJQUFJNEIsQ0FBQyxHQUFHNUIsSUFBSVksSUFBSSxDQUFDZ0IsQ0FBQztJQUM5QixJQUFJLENBQUM1QixJQUFJNkIsaUJBQWlCLEVBQUU3QixJQUFJNkIsaUJBQWlCLEdBQUdDLElBQUFBLHlCQUFhLEVBQUM5QjtJQUVsRSxNQUFNK0IsT0FBTztRQUNYekM7UUFDQUM7UUFDQUM7UUFDQUc7UUFDQUM7UUFDQUM7UUFDQVE7UUFDQUM7UUFDQWxCO1FBQ0FZO1FBQ0FRO1FBQ0FFO0lBQ0Y7SUFFQSxJQUFJckIsUUFBUUMsRUFBRSxFQUFFO1FBQ2QsT0FBTzBDLElBQUFBLG1CQUFVLEVBQVFEO0lBQzNCO0lBQ0EsT0FBT0UsSUFBQUEsZUFBTSxFQUFRRjtBQUN2QjtNQUVBLFdBQWU1QyJ9